# .github/workflows/deploy.yml (ファイル名は任意ですが、わかりやすいものが良いです)

name: Eleventy Build and Deploy

# mainブランチへのプッシュ、またはプルリクエストで実行
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:

# 以下の環境変数を設定（ビルド時の設定に合わせて修正）
env:
  NODE_VERSION: 20 # 使用するNode.jsのバージョン。20以上を推奨
  BUILD_DIR: _site # Eleventyの出力先ディレクトリ

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository 
        uses: actions/checkout@v4

      - name: Setup Node.js 
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
          
      - name: Install dependencies 
        run: npm install

      # Eleventyのビルドコマンドを実行
      - name: Build Eleventy site 
        run: npx @11ty/eleventy

      # --- GitHub Pagesへのデプロイ ---
      # outputで指定したフォルダ（_site）の内容をgh-pagesブランチにデプロイ
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ${{ env.BUILD_DIR }}
          # ★ 重要 ★: .gitignoreで_siteを無視している場合でも、このアクションが処理します
          # files: "**"